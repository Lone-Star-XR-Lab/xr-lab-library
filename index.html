<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lone Star XR Lab - App Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
  <script defer src="app.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-900" x-data="app()" x-init="loadData()">
  <div class="max-w-7xl mx-auto px-4 py-6">
    <div class="flex items-start justify-between gap-3">
      <h1 class="text-3xl font-bold">Lone Star XR Lab - App Library</h1>
      <p class="text-xs text-gray-500">
        <span class="underline decoration-dotted cursor-help" title="XR is an umbrella term for VR, AR, and MR.">What is XR?</span>
      </p>
    </div>

    <div class="my-4">
      <div class="rounded-lg border border-blue-300 bg-blue-50 text-blue-900 px-4 py-3">
        <p class="font-semibold">Only showing apps that are <em>Approved</em> or <em>Installed</em>.</p>
        <p class="text-sm">Items with both <code>approved: false</code> and <code>installed: false</code> are hidden.</p>
      </div>
    </div>

    <div class="mt-6">
      <div class="flex items-center gap-2 border-b border-gray-200 pb-1 mb-4">
        <button type="button"
                class="px-3 py-2 text-sm font-semibold transition-colors border-b-2"
                :class="activeTab==='apps' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                aria-controls="tab-apps"
                :aria-selected="activeTab==='apps'"
                @click="activeTab='apps'">
          App Library
        </button>
        <button type="button"
                class="px-3 py-2 text-sm font-semibold transition-colors border-b-2"
                :class="activeTab==='videos' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                aria-controls="tab-videos"
                :aria-selected="activeTab==='videos'"
                @click="activeTab='videos'">
          Video Content
        </button>
      </div>

      <div x-show="activeTab==='apps'" id="tab-apps">
        <p class="text-xs text-gray-400 italic" x-show="!appsReady">Loading app catalog...</p>
        <template x-if="appsReady">
          <div class="lg:grid lg:grid-cols-12 gap-6">
            <aside class="lg:col-span-4 xl:col-span-3">
              <div class="bg-white border rounded-xl shadow-sm p-4 space-y-6">
                <div>
                  <label class="block text-xs text-gray-600 mb-1">Search</label>
                  <input type="text" x-model="query" placeholder="Title, notes, tags."
                         class="w-full border px-3 py-2 rounded-md shadow-sm">
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <label class="flex items-center gap-2"><input type="checkbox" x-model="approvedOnly"> <span>Approved</span></label>
                  <label class="flex items-center gap-2"><input type="checkbox" x-model="installedOnly"> <span>Installed</span></label>
                </div>
                <div>
                  <h3 class="text-sm font-semibold text-gray-700 mb-2">Quick toggles</h3>
                  <div class="space-y-2 text-sm">
                    <label class="flex items-center gap-2"><input type="checkbox" :checked="quickPills.has('free')" @change="togglePill('free')"> <span>Free</span></label>
                    <label class="flex items-center gap-2"><input type="checkbox" :checked="quickPills.has('short')" @change="togglePill('short')"> <span>&le; 15 min</span></label>
                    <label class="flex items-center gap-2"><input type="checkbox" :checked="quickPills.has('hands')" @change="togglePill('hands')"> <span>Hands</span></label>
                    <label class="flex items-center gap-2"><input type="checkbox" :checked="quickPills.has('lowmotion')" @change="togglePill('lowmotion')"> <span>Low motion</span></label>
                    <label class="flex items-center gap-2"><input type="checkbox" :checked="quickPills.has('quest3')" @change="togglePill('quest3')"> <span>Quest 3</span></label>
                  </div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold text-gray-700 mb-2">Departments</h3>
                  <div class="max-h-52 overflow-y-auto pr-1 space-y-1 text-sm">
                    <template x-for="opt in facetOptions.departments" :key="'dept-'+opt.value">
                      <label class="flex items-center gap-2">
                        <input type="checkbox" :checked="isFacetSelected('departments', opt.value)" @change="toggleFacet('departments', opt.value)">
                        <span x-text="opt.label + ' (' + opt.count + ')'"></span>
                      </label>
                    </template>
                    <p class="text-xs text-gray-400" x-show="!facetOptions.departments.length">No departments available.</p>
                  </div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold text-gray-700 mb-2">Comfort Level</h3>
                  <div class="space-y-1 text-sm">
                    <template x-for="opt in facetOptions.comfort" :key="'comfort-'+opt.value">
                      <label class="flex items-center gap-2">
                        <input type="checkbox" :checked="isFacetSelected('comfort', opt.value)" @change="toggleFacet('comfort', opt.value)">
                        <span x-text="opt.label + ' (' + opt.count + ')'"></span>
                      </label>
                    </template>
                    <p class="text-xs text-gray-400" x-show="!facetOptions.comfort.length">No comfort data.</p>
                  </div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold text-gray-700 mb-2">Input Type</h3>
                  <div class="space-y-1 text-sm">
                    <template x-for="opt in facetOptions.input" :key="'input-'+opt.value">
                      <label class="flex items-center gap-2">
                        <input type="checkbox" :checked="isFacetSelected('input', opt.value)" @change="toggleFacet('input', opt.value)">
                        <span x-text="opt.label + ' (' + opt.count + ')'"></span>
                      </label>
                    </template>
                    <p class="text-xs text-gray-400" x-show="!facetOptions.input.length">No input information.</p>
                  </div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold text-gray-700 mb-2">Devices</h3>
                  <div class="max-h-40 overflow-y-auto pr-1 space-y-1 text-sm">
                    <template x-for="opt in facetOptions.devices" :key="'device-'+opt.value">
                      <label class="flex items-center gap-2">
                        <input type="checkbox" :checked="isFacetSelected('devices', opt.value)" @change="toggleFacet('devices', opt.value)">
                        <span x-text="opt.label + ' (' + opt.count + ')'"></span>
                      </label>
                    </template>
                    <p class="text-xs text-gray-400" x-show="!facetOptions.devices.length">No device information.</p>
                  </div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold text-gray-700 mb-2">Age Range</h3>
                  <div class="space-y-1 text-sm">
                    <template x-for="opt in facetOptions.age" :key="'age-'+opt.value">
                      <label class="flex items-center gap-2">
                        <input type="checkbox" :checked="isFacetSelected('age', opt.value)" @change="toggleFacet('age', opt.value)">
                        <span x-text="opt.label + ' (' + opt.count + ')'"></span>
                      </label>
                    </template>
                    <p class="text-xs text-gray-400" x-show="!facetOptions.age.length">No age information.</p>
                  </div>
                </div>
              </div>
            </aside>

            <div class="lg:col-span-8 xl:col-span-9">
              <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                <span class="text-sm text-gray-500" x-text="filteredApps.length + ' results'"></span>
                <div class="flex items-center gap-2">
                  <label class="text-xs text-gray-600">Sort</label>
                  <select x-model="sortMode" class="border px-3 py-2 rounded-md shadow-sm text-sm">
                    <option value="az">Title A-Z</option>
                    <option value="za">Title Z-A</option>
                  </select>
                </div>
              </div>

              <div class="grid gap-6 sm:grid-cols-2 xl:grid-cols-3">
                <template x-for="(app, index) in filteredApps" :key="index">
                  <div class="bg-white border rounded-xl shadow-sm overflow-hidden flex flex-col">
                    <template x-if="app.logo"><img :src="app.logo" alt="" class="h-44 object-cover w-full" loading="lazy" width="640" height="176"></template>

                    <div class="p-4 flex-1 flex flex-col">
                      <div class="flex items-start gap-2">
                        <h2 class="text-lg font-semibold flex-1 leading-snug" x-text="app.title"></h2>
                        <template x-if="app.approved || app.installed">
                          <span class="text-xs rounded px-2 py-1 border"
                                :class="app.installed ? 'border-green-300 text-green-800 bg-green-50' : 'border-blue-300 text-blue-800 bg-blue-50'"
                                x-text="app.installed ? 'Installed' : 'Approved'"></span>
                        </template>
                      </div>

                      <div class="flex flex-wrap gap-2 mt-2 mb-3">
                        <template x-for="d in parseDepts(app.department)" :key="d">
                          <span class="text-xs px-2 py-0.5 rounded-full border text-gray-700" x-text="d"></span>
                        </template>
                      </div>

                      <div class="flex flex-wrap gap-2 mb-3">
                        <template x-if="facet(app, 'free')"><span class="text-[11px] px-2 py-0.5 rounded-full border">Free</span></template>
                        <template x-if="typeof app.time_min==='number' && app.time_min>0">
                          <span class="text-[11px] px-2 py-0.5 rounded-full border" x-text="'Time: ' + app.time_min + ' min'"></span>
                        </template>
                        <template x-if="(app.input || facet(app,'hands') || facet(app,'controllers'))">
                          <span class="text-[11px] px-2 py-0.5 rounded-full border" x-text="'Input: ' + (app.input || (facet(app,'hands')?'Hands':(facet(app,'controllers')?'Controllers':'-')))"></span>
                        </template>
                        <template x-if="(app.comfort || facet(app,'seated') || facet(app,'room') || facet(app,'standing'))">
                          <span class="text-[11px] px-2 py-0.5 rounded-full border" x-text="'Comfort: ' + (app.comfort || (facet(app,'seated')?'Seated':(facet(app,'room')?'Room-scale':(facet(app,'standing')?'Standing':'Unknown'))))"></span>
                        </template>
                      </div>

                      <template x-if="app.description"><p class="text-sm text-gray-800 mb-2" x-text="app.description"></p></template>
                      <template x-if="app.educational"><p class="text-sm text-blue-900 italic mb-2">Educational highlight: <span x-text="app.educational"></span></p></template>

                      <div class="mt-auto flex items-center justify-between">
                        <div class="text-xs text-gray-600 truncate" x-text="Array.isArray(app.tags) ? app.tags.join(', ') : (app.tags || '')"></div>
                        <div class="flex items-center gap-3">
                          <template x-if="app.link"><a :href="app.link" target="_blank" class="text-blue-600 hover:underline text-sm">View</a></template>
                          <button class="text-sm underline" @click="toggleDetails(index)" :aria-expanded="!!detailsOpen[index]" :aria-controls="'details-'+index" x-text="detailsOpen[index] ? 'Hide details' : 'Details'"></button>
                        </div>
                      </div>

                      <div x-show="detailsOpen[index]" x-transition class="mt-3 border-t pt-3 text-sm text-gray-700" :id="'details-'+index">
                        <dl class="grid grid-cols-2 gap-x-4 gap-y-1">
                          <dt class="text-gray-500">Cost</dt><dd x-text="app.cost || 'Unknown'"></dd>
                          <dt class="text-gray-500">Time</dt><dd x-text="(typeof app.time_min==='number' && app.time_min>0) ? (app.time_min + ' min') : 'Unknown'"></dd>
                          <dt class="text-gray-500">Comfort</dt><dd x-text="app.comfort || 'Unknown'"></dd>
                          <dt class="text-gray-500">Motion</dt><dd x-text="app.motion_level || 'Unknown'"></dd>
                          <dt class="text-gray-500">Input</dt><dd x-text="app.input || 'Unknown'"></dd>
                          <dt class="text-gray-500">Devices</dt><dd x-text="Array.isArray(app.devices) && app.devices.length ? app.devices.join(', ') : 'Unknown'"></dd>
                          <template x-if="app.age"><template><dt class="text-gray-500">Age</dt><dd x-text="app.age"></dd></template></template>
                        </dl>

                        <template x-if="app.content_notes"><p class="mt-3 text-xs text-gray-600" x-text="'Notes: ' + app.content_notes"></p></template>

                        <p class="mt-2 text-xs text-gray-600">
                          <span x-text="'Approved: ' + (app.approved ? 'Yes' : 'No')"></span>
                          <span class="ml-4" x-text="'Installed: ' + (app.installed ? 'Yes' : 'No')"></span>
                        </p>

                        <div class="mt-3 flex gap-3">
                          <template x-if="app.link"><a :href="app.link" target="_blank" class="text-blue-600 hover:underline text-sm">Open store page</a></template>
                          <button class="text-sm underline" @click="navigator.clipboard?.writeText(app.link || window.location.href)">Copy link</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </template>
        <p class="mt-6 text-xs text-gray-500" x-show="appsReady && filteredApps.length === 0">No results found.</p>
      </div>

      <div x-show="activeTab==='videos'" id="tab-videos">
        <p class="text-xs text-gray-400 italic" x-show="!videosReady">Loading video catalog...</p>
        <template x-if="videosReady">
          <div class="lg:grid lg:grid-cols-12 gap-6">
            <aside class="lg:col-span-4 xl:col-span-3">
              <div class="bg-white border rounded-xl shadow-sm p-4 space-y-5">
                <div class="flex items-center justify-between">
                  <h2 class="text-sm font-semibold text-gray-700">Filters</h2>
                  <button class="text-xs text-blue-600 hover:underline" @click="clearVideoFilters()">Reset</button>
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1">Search</label>
                  <input type="text" x-model="videoQuery" placeholder="Title, notes, tags." class="w-full border px-3 py-2 rounded-md shadow-sm">
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1">Department</label>
                  <select x-model="videoDepartment" class="w-full border px-3 py-2 rounded-md shadow-sm text-sm">
                    <option value="">All Departments</option>
                    <template x-for="opt in videoDepartmentOptions" :key="'video-'+opt.value">
                      <option :value="opt.value" x-text="opt.label + ' (' + opt.count + ')'"></option>
                    </template>
                  </select>
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1">Sort</label>
                  <select x-model="videoSortMode" class="w-full border px-3 py-2 rounded-md shadow-sm text-sm">
                    <option value="az">Title A-Z</option>
                    <option value="za">Title Z-A</option>
                  </select>
                </div>
              </div>
            </aside>
            <div class="lg:col-span-8 xl:col-span-9">
              <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                <span class="text-sm text-gray-500" x-text="filteredVideos.length + ' results'"></span>
              </div>
              <div class="grid gap-6 sm:grid-cols-2 xl:grid-cols-3">
                <template x-for="(video, vIndex) in filteredVideos" :key="'video-'+vIndex">
                  <div class="bg-white border rounded-xl shadow-sm overflow-hidden flex flex-col">
                    <template x-if="video.logo"><img :src="video.logo" alt="" class="h-44 object-cover w-full" loading="lazy" width="640" height="176"></template>

                    <div class="p-4 flex-1 flex flex-col">
                      <h2 class="text-lg font-semibold leading-snug" x-text="video.title"></h2>

                      <div class="flex flex-wrap gap-2 mt-2 mb-3">
                        <template x-for="dept in parseDepts(video.department)" :key="dept">
                          <span class="text-xs px-2 py-0.5 rounded-full border text-gray-700" x-text="dept"></span>
                        </template>
                        <template x-if="video.platform">
                          <span class="text-[11px] px-2 py-0.5 rounded-full border border-purple-200 bg-purple-50 text-purple-700" x-text="video.platform"></span>
                        </template>
                      </div>

                      <template x-if="video.description"><p class="text-sm text-gray-800 mb-2" x-text="video.description"></p></template>
                      <template x-if="video.educational"><p class="text-sm text-blue-900 italic mb-2" x-text="video.educational"></p></template>
                      <template x-if="video.tags"><p class="text-xs text-gray-600 mb-2" x-text="video.tags"></p></template>
                      <template x-if="video.notes"><p class="text-xs text-gray-500 mb-3" x-text="video.notes"></p></template>

                      <div class="mt-auto flex items-center justify-between">
                        <div class="text-xs text-gray-500 truncate" x-text="video.link ? video.link : 'No external link provided'"></div>
                        <div class="flex items-center gap-3">
                          <template x-if="video.link"><a :href="video.link" target="_blank" class="text-blue-600 hover:underline text-sm">Watch</a></template>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </template>
        <p class="mt-6 text-xs text-gray-500" x-show="videosReady && filteredVideos.length === 0">No videos match the current filters.</p>
      </div>
    </div>
  </div>

</body>
</html>
